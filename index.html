<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Valentine's Surprise</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Nunito:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --pink-top: #ffafbd;
            --pink-bottom: #ffc3a0;
            --deep-red: #d63031;
            --white: #ffffff;
        }

        body {
            margin: 0; padding: 0; font-family: 'Nunito', sans-serif;
            background: linear-gradient(to bottom, var(--pink-top), var(--pink-bottom));
            height: 100vh; overflow: hidden; color: #333;
        }

        .screen {
            position: absolute; width: 100%; height: 100%;
            display: none; flex-direction: column; align-items: center;
            justify-content: center; text-align: center; padding: 20px; box-sizing: border-box;
        }
        .active-screen { display: flex; z-index: 10; animation: fadeIn 0.5s; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* STICKERS */
        .sticker { width: 150px; margin-bottom: 15px; filter: drop-shadow(0 5px 10px rgba(0,0,0,0.1)); }

        /* --- GIFT BOXES --- */
        .gift-grid { display: flex; gap: 20px; }
        .gift-box-2d {
            width: 90px; height: 90px; background: var(--deep-red);
            border-radius: 12px; position: relative; cursor: pointer;
            transition: transform 0.6s; transform-style: preserve-3d;
            box-shadow: 0 8px 0 #b33939;
        }
        .gift-box-2d.flipped { transform: rotateY(180deg); }
        .gift-front, .gift-back {
            position: absolute; width: 100%; height: 100%;
            backface-visibility: hidden; border-radius: 10px;
            display: flex; align-items: center; justify-content: center;
        }
        .gift-back { background: #fff; transform: rotateY(180deg); color: var(--deep-red); font-size: 1.5rem; }

        /* --- BOX 3 FLIP CARDS --- */
        .flip-card { width: 130px; height: 90px; perspective: 1000px; margin: 10px; }
        .flip-inner { position: relative; width: 100%; height: 100%; transition: transform 0.6s; transform-style: preserve-3d; }
        .flip-card.flipped .flip-inner { transform: rotateY(180deg); }
        .flip-front, .flip-back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 10px; display: flex; align-items: center; justify-content: center; }
        .flip-front { background: #fff; border: 2px dashed var(--deep-red); font-weight: bold; }
        .flip-back { background: var(--deep-red); color: white; transform: rotateY(180deg); padding: 10px; font-size: 0.85rem; }

        /* --- FINALE (ROPE FATE) --- */
        .final-slide { background: #fff0f3; overflow-y: auto; overflow-x: hidden; justify-content: flex-start; padding-top: 50px; }
        .rope-svg { position: absolute; top: 0; left: 0; width: 100%; height: 1500px; pointer-events: none; }
        .msg-node { 
            position: relative; width: 240px; background: white; padding: 12px; 
            border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); margin: 50px 0; z-index: 2;
        }
        .node-left { align-self: flex-start; margin-left: 15px; }
        .node-right { align-self: flex-end; margin-right: 15px; }
        .node-img { width: 100%; border-radius: 10px; margin-bottom: 8px; }

        .btn { padding: 12px 28px; border-radius: 50px; border: none; background: var(--deep-red); color: white; cursor: pointer; margin-top: 15px; font-weight: bold; }
        input { padding: 12px; border-radius: 10px; border: 1px solid #ddd; margin: 10px; width: 200px; text-align: center; }
    </style>
</head>
<body>

    <audio id="song1" loop><source src="SONG_1.mp3"></audio>
    <audio id="song2" loop><source src="SONG_2.mp3"></audio>
    <audio id="popSfx" src="CLICK_SOUND.mp3"></audio>
    <audio id="flipSfx" src="FLIP_SOUND.mp3"></audio>

    <div id="screen-1" class="screen active-screen">
        <img src="MAIN_VALENTINE_STICKER.png" class="sticker">
        <h1 style="font-family: 'Dancing Script'; font-size: 2.6rem; color: var(--deep-red);">Will you be my valentine?</h1>
        <div>
            <button class="btn" onclick="startFlow()">YES</button>
            <button class="btn" style="background:white; color:#333;" onclick="nextScreen(2)">NO</button>
        </div>
    </div>

    <div id="screen-2" class="screen">
        <img src="HUMPH_CAT.png" class="sticker">
        <p>I ain't no cruel person... I'll give you another chance.</p>
        <button class="btn" onclick="nextScreen(1)">YES</button>
        <button class="btn" onclick="nextScreen(3)">NO</button>
    </div>

    <div id="screen-3" class="screen">
        <h1 style="font-weight: 900; font-size: 2.2rem; color:black;">HOW DARE YOU!!</h1>
        <img src="ANGRY_STICKER.png" class="sticker">
        <p>To unlock Sorry, answer this:<br><b>What's my favorite flower?</b></p>
        <input type="text" id="flowerInput" placeholder="Enter flower name...">
        <p id="attemptCounter" style="color:red; font-size: 0.9rem;">Attempts: 3</p>
        <button class="btn" onclick="checkFlower()">Check Answer</button>
        <button id="sorryBtn" class="btn" disabled style="opacity:0.3;" onclick="nextScreen(1)">Sorry</button>
    </div>

    <div id="screen-4" class="screen">
        <h2 style="font-family: 'Dancing Script';">Select a Gift</h2>
        <div class="gift-grid">
            <div class="gift-box-2d" id="gb1" onclick="handleBoxFlip(1)">
                <div class="gift-front">üéÅ</div><div class="gift-back">‚ûú</div>
            </div>
            <div class="gift-box-2d" id="gb2" onclick="handleBoxFlip(2)">
                <div class="gift-front">üéÅ</div><div class="gift-back">‚ûú</div>
            </div>
            <div class="gift-box-2d" id="gb3" onclick="handleBoxFlip(3)">
                <div class="gift-front">üéÅ</div><div class="gift-back">‚ûú</div>
            </div>
        </div>
    </div>

    <div id="screen-5" class="screen">
        <img src="COUPLE_PHOTO_1.jpg" style="width:230px; border-radius:15px; border: 5px solid white;">
        <p style="font-style:italic; font-size: 1.1rem; padding: 0 20px;">"Like stars in the sky, we shine together."</p>
        <button class="btn" onclick="nextScreen(4)">‚¨Ö Back</button>
    </div>

    <div id="screen-6" class="screen">
        <div style="display: flex; gap: 10px; justify-content: center; margin-bottom: 15px;">
            <img src="PHOTO_A.jpg" style="width:130px; height:130px; object-fit:cover; border-radius:15px; border: 3px solid white;">
            <img src="PHOTO_B.jpg" style="width:130px; height:130px; object-fit:cover; border-radius:15px; border: 3px solid white;">
        </div>
        <p style="font-weight: bold; color: var(--deep-red);">You are the best thing that ever happened to me.</p>
        <button class="btn" onclick="nextScreen(4)">‚¨Ö Back</button>
    </div>

    <div id="screen-7" class="screen">
        <div style="display:flex; flex-wrap:wrap; justify-content:center;">
            <div class="flip-card" onclick="cardFlip(this)"><div class="flip-inner"><div class="flip-front">1</div><div class="flip-back">You are Always mine.</div></div></div>
            <div class="flip-card" onclick="cardFlip(this)"><div class="flip-inner"><div class="flip-front">2</div><div class="flip-back">I am Forever yours.</div></div></div>
            <div class="flip-card" onclick="cardFlip(this)"><div class="flip-inner"><div class="flip-front">3</div><div class="flip-back">Always Stay happy.</div></div></div>
            <div class="flip-card" onclick="cardFlip(this)"><div class="flip-inner"><div class="flip-front">4</div><div class="flip-back">I always Love you!</div></div></div>
        </div>
        <button class="btn" onclick="showFinale()">Wanna hear more? üòç</button>
    </div>

    <div id="screen-8" class="screen final-slide">
        <svg class="rope-svg"><path id="ropePath" d="" fill="none" stroke="red" stroke-width="3" stroke-dasharray="10"/></svg>
        <div class="msg-node node-left"><img src="FINAL_P1.jpg" class="node-img"><p>My first thought...</p></div>
        <div class="msg-node node-right"><img src="FINAL_P2.jpg" class="node-img"><p>My only wish...</p></div>
        <div class="msg-node node-left"><img src="FINAL_P3.jpg" class="node-img"><p>Our future...</p></div>
        <div class="msg-node node-right"><img src="FINAL_P4.jpg" class="node-img"><p>Forever us.</p></div>
        <button class="btn" onclick="location.reload()" style="z-index:100; margin: 40px 0;">Read Again ‚Ü∫</button>
    </div>

    <script>
        let attempts = 3;
        const pop = document.getElementById('popSfx');
        const flip = document.getElementById('flipSfx');
        const s1 = document.getElementById('song1');
        const s2 = document.getElementById('song2');

        function nextScreen(id) {
            pop.currentTime = 0; pop.play();
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active-screen'));
            document.getElementById('screen-'+id).classList.add('active-screen');
        }

        function startFlow() { s1.play(); nextScreen(4); }

        // UPDATED FUNCTION: CHECKS FOR "TULIP"
        function checkFlower() {
            const val = document.getElementById('flowerInput').value.toLowerCase();
            if(val === "tulip") {
                document.getElementById('sorryBtn').disabled = false;
                document.getElementById('sorryBtn').style.opacity = 1;
                alert("Correct! Access granted.");
            } else {
                attempts--;
                document.getElementById('attemptCounter').innerText = "Attempts: " + attempts;
                if(attempts <= 0) alert("Blocked! Refresh page.");
            }
        }

        function handleBoxFlip(n) {
            const box = document.getElementById('gb'+n);
            if(!box.classList.contains('flipped')) {
                box.classList.add('flipped'); flip.play();
            } else {
                if(n===1) nextScreen(5);
                if(n===2) nextScreen(6);
                if(n===3) nextScreen(7);
            }
        }

        function cardFlip(el) { el.classList.toggle('flipped'); flip.play(); }

        function showFinale() {
            s1.pause(); s2.play();
            nextScreen(8);
            setTimeout(drawRope, 200);
        }

        function drawRope() {
            const nodes = document.querySelectorAll('.msg-node');
            const path = document.getElementById('ropePath');
            let dString = "";
            nodes.forEach((node, i) => {
                const cx = node.offsetLeft + (node.offsetWidth / 2);
                const cy = node.offsetTop + (node.offsetHeight / 2);
                if(i === 0) dString += `M ${cx} ${cy}`;
                else {
                    const px = nodes[i-1].offsetLeft + (nodes[i-1].offsetWidth / 2);
                    const py = nodes[i-1].offsetTop + (nodes[i-1].offsetHeight / 2);
                    dString += ` C ${px} ${cy}, ${cx} ${py}, ${cx} ${cy}`;
                }
            });
            path.setAttribute('d', dString);
        }
    </script>
</body>
</html>
